# WoodenOx-mysql
Plan Event script for mysql
# 简介
这是一个可以按照指定时间执行mysql任务的Python脚本，它可以在指定时间执行一项存储过程、并在日志中记录相关信息
# 目的
主要面对的是对数据库结构进程操作的命令，比如创建表、删除字段等等这些敏感的操作、或者是为拥有数千万行数据的表建立索引这样耗费资源的工作，这样做的好处有：
  
  - 可定时在业务低峰期进行提交改动，避免了在访问高峰期时对数据库进行改动引起的性能问题。
  - 延迟提交、以SQL文件的方式进行提交，使管理员编写SQL语句时逻辑清晰、减少出错的可能
  - 在日志中可以清晰的查看到时间、具体语句等参数

# 运行环境
  mysql 5.1及更高的版本

# 功能
（功能3、4暂未实现）
1. SQL语句定时执行 
2. 将查询结果生成日志，日志的格式如下：  
   本地时间  时间名称  user@host  执行时间  执行的SQL语句  
   例：2017-09-04 21:31:17  OXEvent20170904213117  dyc@localhost  2017-09-07 8:48:30  INSERT INTO testDB.testTable (name)  VALUES ('imdyc');
3. 查询已经提交的计划
4. 通过监控mysql，当mysql执行了event时、将影响的行数、是否执行成功、抛出的警告等信息记录在日志中

# 文件结构
  WoodenOx-mysql.py：主文件  
  reConfig.py：读配置文件功能模块
  wrLog.py：写日志功能模块
# 配置文档填写指南
  - 支持注释
      - 只接受单独行注释，将注释接在配置代码后面可能引发异常或意料之外的错误
      - 注释格式为“#”开头的行（如：# 程序执行负责人:imdyc.com），程序会识别到并忽略此行。
  - 编写[SQL]块时应该注意，这时候提交的SQL代码以Evemt（事件）的方式提交，需要遵守的语法与存储过程一样，比如`USE bookDB`就不能在其中使用（应该在[connection_parameter]块的database变量中填写） 

# 额外说明
  运行程序时，先显示了本地时间，连接上数据库后使用 SELECT now() 显示数据库服务器的时间；
  数据库与WoodenOx-mysql在同一台计算机上运行时，可能显示的服务器时间比本地时间晚一秒甚至数秒：这可能是Python处理数据库连接的时延问题。
  数据库与WoodenOx-mysql不在同一台计算机运行时，可能显示的服务器时间比本地时间早或晚一些时间：这可能是时区、操作系统时间设置上的差异，或者是网络延迟、Python处理数据库连接的时延问题

  如果在根目录下没有eventLog.wo,程序会新建,不建议手动创建eventLog.wo文件，以免运行时出现编码冲突。

